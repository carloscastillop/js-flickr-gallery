/** 
 * @projectDescription JsFlickrGallery - Simple JavaScript Flickr gallery, http://petejank.github.io/js-flickr-gallery/
 * 
 * @version 1.0.1
 * @author   Peter Jankowski http://likeadev.com
 * @license  MIT license.
 */
;(function(g,l,n,d){var j="json",q="flickr.photos.search",p="62525ee8c8d131d708d33d61f29434b6",a="data-tags",i="data-user-id",c="data-per-page",h="data-gallery-id",m=767,b=10000,f="jsfg";var k="jsFlickrGallery",e={fetchImages:true,animation:"fade",animationSpeed:250,preload:{range:2},structure:{ulClass:"thumbnails",liClass:"span1",aClass:"thumbnail"},modal:{generate:true,id:"jsfg-modal",title:".modal-header h3",imageContainer:".modal-body .modal-image",onContainerNext:true,imageFadeTime:250,prev:".modal-prev",next:".modal-next",prevText:"Previous image",nextText:"Next image",offsetWidth:100,offsetHeight:200},pagination:{generate:true,containerClass:"pagination",prev:".pagination-prev",next:".pagination-next",prevText:"Previous page",nextText:"Next page"},loader:{animation:true,loaderClass:"jsfg-loader",text:"Loading",interval:200,mark:".",markClass:"animation-marks",maxMarks:3},url:{per_page:30,tagmode:"all",user_id:null,tags:null},error:{text:"No photos found",tagClass:"error"},imageSizes:{small:"s",medium_100:"t",medium:"q",medium_640:"z",large:"b",original:"o"},apiUrl:"http://api.flickr.com/services/rest/?jsoncallback=?",setDefaultSize:function(){this.thumbnailSize=this.imageSizes.medium;this.imageSize=this.imageSizes.large}};function o(s,r){this.element=s;this.$element=g(s);this.options=g.extend(true,{},e,r);this.paginationContext=this.options.pagination&&this.options.pagination.generate?this.element:n;if(!this.options.thumbnailSize&&!this.options.imageSize){this.options.setDefaultSize()}this.anchors="ul"+(this.options.structure.ulClass?"."+this.options.structure.ulClass:null)+" li a"+(this.options.structure.aClass?"."+this.options.structure.aClass:null);this.galleryId=this.element.id||Math.random().toString(36);this.page=1;this.init()}o.prototype={init:function(){if(this.options.fetchImages){if(this.options.loader){this.loaderInterval=this._createLoader(this.$element)}this.createGallery()}else{this.$anchors=g(this.anchors,this.$element)}if(this.options.pagination&&this.options.fetchImages){if(this.options.pagination.generate){this._createPagination()}this._bindPaginationEvents()}if(this.options.modal){if(this.options.modal.generate){this._createModal()}this._bindModalEvents()}},createGallery:function(r){this.options.url.format=j;this.options.url.method=q;this.options.url.api_key=p;this.options.url.page=this.page=r||this.page;this.options.url.tags=this.$element.attr(a)||this.options.url.tags;this.options.url.user_id=this.$element.attr(i)||this.options.url.user_id;if(!this.options.url.user_id){delete this.options.url.user_id}this.options.url.per_page=this.$element.attr(c)||this.options.url.per_page;this._getPhotos();return this},clearGallery:function(){var r=g("ul."+this.options.structure.ulClass,this.$element),t=this;switch(this.options.animation){case"fade":r.fadeOut(this.options.animationSpeed,function(){s()});break;case"show":r.hide(this.options.animationSpeed,function(){s()});break;case false:r.hide(0,function(){s()})}function s(){if(t.options.loader){t.loaderInterval=t._createLoader(t.$element)}r.remove()}return this},isLastPage:function(){return this.$element.children("ul").find("li").length<this.options.url.per_page},nextPage:function(){if(!this.isLastPage()){return this.clearGallery().createGallery(this.page+1)}else{return false}},prevPage:function(){if(this.page>1){return this.clearGallery().createGallery(this.page-1)}else{return false}},prevImage:function(){this.index-=1;if(this.index<0){this.index=this.$anchors.length-1}return this._loadImage(false)},nextImage:function(){this.index+=1;if(this.index>this.$anchors.length-1){this.index=0}return this._loadImage(false)},_getPhotos:function(){var r=this;g.ajax({type:"GET",url:r.options.apiUrl,data:r.options.url,dataType:"jsonp",timeout:b}).done(function(s){r._renderGalleryContent(s.photos)}).always(function(s,t){if(t==="timeout"){r._getPhotos()}})},_renderGalleryContent:function(z){var v=this,r,u,s="",w=0,x,y;if(z.photo.length>0){u=g("<ul "+(v.options.structure.ulClass?'class="'+v.options.structure.ulClass+'"':null)+' style="display: none">');for(var t=0;t<z.photo.length;t++){x="http://farm"+z.photo[t].farm+".static.flickr.com/"+z.photo[t].server+"/"+z.photo[t].id+"_"+z.photo[t].secret+"_";y=this._htmlEscape(z.photo[t].title);s+="<li "+(v.options.structure.liClass?'class="'+v.options.structure.liClass+'"':null)+'><a href="'+x+v.options.imageSize+'.jpg" title="'+y+'"'+(v.options.structure.aClass?'class="'+v.options.structure.aClass+'"':null)+'  target="_blank"><img alt="'+y+'" src="'+x+v.options.thumbnailSize+'.jpg"/></a></li>'}v.$element.prepend(u.append(s));r=u.find("img");r.on("error",function(){var A=g(this),B=A.attr("src");A.attr("src",null).attr("src",B)});r.on("load",function(){w++;if(w===z.photo.length){v._removeLoader(v.$element);switch(v.options.animation){case"fade":u.fadeIn(v.options.animationSpeed);break;case"show":u.show(v.options.animationSpeed);break;case false:u.show()}r.off("load").off("error");v.$anchors=g(v.anchors,v.$element);v._togglePagination()}})}else{v.$element.prepend('<span class="'+v.options.error.tagClass+'">'+v.options.error.text+"</span>");v._removeLoader(v.$element)._togglePagination()}return v},_htmlEscape:function(r){return r.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},_createPagination:function(){var s="",t=g(this.options.pagination.prev,this.paginationContext),r=g(this.options.pagination.next,this.paginationContext);if(t.length===0&&r.length===0&&this.options.pagination.generate){s+='<div class="'+this.options.pagination.containerClass+'"><button class="btn'+this.options.pagination.prev.replace(/\./g," ")+'" title="'+this.options.pagination.prevText+'" '+(this.page===1?'disabled="disabled" ':null)+' >&laquo;</button><button class="btn'+this.options.pagination.next.replace(/\./g," ")+'" title="'+this.options.pagination.nextText+'" '+(this.isLastPage()?' disabled="disabled" ':null)+">&raquo;</button></div>";this.$element.append(s)}return this},_bindPaginationEvents:function(){var t=this,s=g(this.options.pagination.prev,this.paginationContext),r=g(this.options.pagination.next,this.paginationContext);s.click(function(){if(!s.is(":disabled")){r.attr("disabled","disabled");s.attr("disabled","disabled");t.prevPage()}});r.click(function(){if(!r.is(":disabled")){s.attr("disabled","disabled");r.attr("disabled","disabled");t.nextPage()}})},_togglePagination:function(){if(this.page!==1){g(this.options.pagination.prev,this.paginationContext).removeAttr("disabled")}else{g(this.options.pagination.prev,this.paginationContext).attr("disabled","disabled")}if(!this.isLastPage()){g(this.options.pagination.next,this.paginationContext).removeAttr("disabled")}else{g(this.options.pagination.next,this.paginationContext).attr("disabled","disabled")}return this},_createModal:function(){var t,r,s;if(g("#"+this.options.modal.id).length===0){t='<div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h3></h3></div>',r='<div class="modal-body"><div class="modal-image"></div></div>',s='<div class="modal-footer"><button title="'+this.options.modal.prevText+'" class="btn'+this.options.modal.prev.replace(/\./g," ")+'">&laquo;</button><button title="'+this.options.modal.nextText+'" class="btn btn-primary'+this.options.modal.next.replace(/\./g," ")+'">&raquo;</button></div>';g("body").append('<div id="'+this.options.modal.id+'" class="modal jsfg-modal hide fade">'+t+r+s+"</div>")}return this},_bindModalEvents:function(){var u=this,t=this.options.modal.onContainerNext?this.options.modal.next+", "+this.options.modal.imageContainer:this.options.modal.next,r,s="#"+this.options.modal.id;this.$element.on("click",this.anchors,function(v){v.preventDefault();g("#"+u.options.modal.id).attr(h,u.galleryId);u.index=u.$anchors.find("img").index(g(this).find("img"));u._loadImage(true)});r=g("#"+u.options.modal.id);g(t,s).click(function(v){v.preventDefault();if(r.attr(h)===u.galleryId){u.nextImage()}});g(this.options.modal.prev,s).click(function(v){v.preventDefault();if(r.attr(h)===u.galleryId){u.prevImage()}});return this},_loadImage:function(w){var v=this,y=g("#"+this.options.modal.id),x=g(this.options.modal.title,y),r=v.index,z=g(this.$anchors[this.index]),t=g('<img style="display: none"/>'),u=g(this.options.modal.imageContainer,y),s=g(l);u.children().hide();x.text(z.attr("title"));if(w){y.modal("show")}t.on("error",function(){t.attr("src",null).attr("src",z.attr("href"))});t.on("load",function(){if(v.index===r){u.children().remove();v._removeLoader(u);t=v._resizeToFit(t,s);x.width(t[0].width);u.height(t[0].height).width(t[0].width);t.appendTo(v.options.modal.imageContainer);if(s.width()>m){y.css("top","");(g.support.transition?y.animate:y.css).call(y.stop(),{"margin-left":-y.outerWidth()/2,"margin-top":-y.outerHeight()/2})}else{y.css({top:(s.height()-y.outerHeight())/2,"margin-left":"","margin-top":""})}t.fadeIn(v.options.modal.imageFadeTime);if(v.options.preload){v._preloadImages()}}t.off("load").off("error")});t.attr("src",z.attr("href")).attr("alt",z.attr("title"));if(!t[0].complete){this.loaderInterval=this._createLoader(u)}return this},_preloadImages:function(){var u=this.index+this.options.preload.range+1,s=this.index-this.options.preload.range,r,t;for(t=s;t<u;t++){r=this.$anchors[t];if(r&&t!==this.index){g(n.createElement("img")).attr("src",r.href||g(r).attr("href"))}}return this},_resizeToFit:function(u,s){var x=1,w,v,t=u[0].width,r=u[0].height;w=s.width()-this.options.modal.offsetWidth;v=s.height()-this.options.modal.offsetHeight;if(t>w||r>v){x=Math.min(w/t,v/r)}u[0].width*=x;u[0].height*=x;return u},_createLoader:function(r){var t=g('<span class="'+this.options.loader.markClass+'"></span>'),s=this.options;r.prepend(g('<p class="'+s.loader.loaderClass+'">'+s.loader.text+"</span>").append(t));if(s.loader.animation){return setInterval(function(){if(t.text().length<=s.loader.maxMarks){t.append(s.loader.mark)}else{t.text("")}},s.loader.interval)}else{return true}},_removeLoader:function(r){if(this.loaderInterval){r.children("."+this.options.loader.loaderClass).remove();clearInterval(this.loaderInterval)}return this}};g.fn[k]=function(r){return this.each(function(){if(!g.data(this,"plugin_"+k)){g.data(this,"plugin_"+k,new o(this,r))}})};g(function(){g('[data-toggle="'+f+'"]').jsFlickrGallery()})})(jQuery,window,document);